"use strict";var $id=document.getElementById.bind(document),$ele=document.createElement.bind(document),$div=function(t,e){var i=$ele("div");return e&&(i.innerHTML=e),t&&(i.className=t),i.html=function(){return'<div class="'+i.className+'">'+i.innerHTML+"</div>"},i},URL=function(t){t=t||{},this.qs={q:t.q||null,limit:t.limit||10,offset:t.offset||0,callback:t.callback||"ajax.callback"},this._events={}};URL.baseUrl="https://api.twitch.tv/kraken/search/streams",URL.prototype.url=function(){var t=this.qs,e=Object.keys(t).filter(function(e){return null!=t[e]}).map(function(e){return e+"="+t[e]}).join("&"),i=URL.baseUrl+(e?"?":"")+e;return i},URL.prototype.addOffset=function(t){var e=(this.qs.offset||0)+t;this.update(this.qs.q,this.qs.limit,e)},URL.prototype.update=function(t,e,i){this.qs.q=t||null,this.qs.limit=void 0!=e?e:this.qs.limit||10,this.qs.offset=void 0!=i?i:this.qs.offset||0,this._events.update&&this._events.update()},URL.prototype.on=function(t,e){return t=t.toLowerCase(),["update"].indexOf(t)>-1&&(this._events[t]=e),this};var Ajax=function(t){this._events={},this.url=t||""};Ajax.prototype.qs=function(t){var e="&"+(this.url.split("?")[1]||"")+"&",i=new RegExp("&"+t+"=(.*?)&","i");return e.match(i)?e.match(i)[1]:void 0},Ajax.prototype.on=function(t,e){return t=t.toLowerCase(),["get","error"].indexOf(t)>-1&&(this._events[t]=e),this},Ajax.prototype.update=function(t){var e=new XMLHttpRequest;return this.url=t,this.qs("q")?(e.open("GET",t||this.url),e.send(),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){for(var t=document.body.getElementsByTagName("script"),i=0;i<t.length;i++)t[i].classList.contains("search_result")&&t[i].parentElement.removeChild(t[i]);var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.classList.add("search_result"),n.innerHTML=e.responseText,document.body.appendChild(n)}},e):void 0},Ajax.prototype.callback=function(t){this._events.get(t)};var Pagination=function(){this.pages=0,this.currentPage=0};Pagination.prototype.setPage=function(t){this.currentPage=t},Pagination.prototype.setTotal=function(t){this.pages=t},Pagination.prototype.prevHTML=function(){return $div("prevPage","←")},Pagination.prototype.nextHTML=function(){return $div("nextPage","→")},Pagination.prototype.html=function(t,e){return pagination.prevHTML().html()+" "+this.currentPage+"/"+this.pages+" "+pagination.nextHTML().html()},Pagination.prototype.hasPrev=function(){return this.currentPage>1},Pagination.prototype.hasNext=function(){return this.currentPage<this.pages};var twitch=new URL,ajax=new Ajax(twitch.url()),pagination=new Pagination;twitch.on("update",function(){ajax.update(twitch.url()),sessionStorage.setItem("searchTerm",twitch.qs.q)}),ajax.on("get",function(t){if(t){var e=t.streams,i=t._total,n=0===i?0:Math.floor(ajax.qs("offset")/10)+1,a=0===i?0:Math.ceil(i/10);pagination.setPage(n),pagination.setTotal(a),$id("count").innerText="Total Results: "+i,$id("pagination").innerHTML=pagination.html(),$id("bottom_pagination").innerHTML=pagination.html();for(var s=$id("video_results");s.lastChild;)s.lastChild.className=s.lastChild.className+" removing",s.removeChild(s.lastChild);if(0===i){$id("navigation_help").classList.remove("show");var o=$div("no_results","Sorry, no results for: <strong>"+twitch.qs.q+"</strong>");s.appendChild(o)}else $id("navigation_help").classList.add("show"),e.forEach(function(t){var e=$ele("img");e.src=t.preview.medium,e.width=192,e.height=108,e.align="left";var i=$div("display_name",t.channel.display_name),n=$div("desc",t.channel.status),a=$div("game_name","Playing "+t.game),o=$div("viewers",t.channel.views+" viewers"),r=$div("videos");r.appendChild(e),r.appendChild(i),r.appendChild(a),r.appendChild(o),r.appendChild(n),s.appendChild(r)})}}),document.addEventListener("DOMContentLoaded",function(){sessionStorage.getItem("searchTerm")&&($id("q").value=sessionStorage.getItem("searchTerm"),twitch.update($id("q").value)),$id("search").addEventListener("click",function(t){twitch.update($id("q").value)}),document.body.addEventListener("click",function(t){if(["nextPage","prevPage"].indexOf(t.target.className)>-1){var e=twitch.qs.limit;"prevPage"===t.target.className&&pagination.hasPrev()&&twitch.addOffset(-e),"nextPage"===t.target.className&&pagination.hasNext()&&twitch.addOffset(e),t.preventDefault()}})}),document.addEventListener("keydown",function(t){t.shiftKey||t.ctrlKey||t.altKey||(37===t.keyCode&&pagination.hasPrev()&&twitch.addOffset(-twitch.qs.limit),39===t.keyCode&&pagination.hasNext()&&twitch.addOffset(twitch.qs.limit))});