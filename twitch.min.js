"use strict";var $id=document.getElementById.bind(document),$ele=document.createElement.bind(document),$div=function(e,t){var a=$ele("div");return t&&(a.innerHTML=t),e&&(a.className=e),a.html=function(){return'<div class="'+a.className+'">'+a.innerHTML+"</div>"},a},URL=function(e){e=e||{},this.qs={q:e.q||null,limit:e.limit||10,offset:e.offset||0,callback:e.callback||"ajax.callback"},this._events={}};URL.baseUrl="https://api.twitch.tv/kraken/search/streams",URL.prototype.url=function(){var e=this.qs,t=Object.keys(e).filter(function(t){return null!=e[t]}).map(function(t){return t+"="+e[t]}).join("&"),a=URL.baseUrl+(t?"?":"")+t;return a},URL.prototype.addOffset=function(e){var t=(this.qs.offset||0)+e;this.update(this.qs.q,this.qs.limit,t)},URL.prototype.update=function(e,t,a){this.qs.q=e||null,this.qs.limit=void 0!=t?t:this.qs.limit||10,this.qs.offset=void 0!=a?a:this.qs.offset||0,this._events.update&&this._events.update()},URL.prototype.on=function(e,t){return e=e.toLowerCase(),["update"].indexOf(e)>-1&&(this._events[e]=t),this};var Ajax=function(e){this._events={},this.url=e||""};Ajax.prototype.qs=function(e){var t="&"+(this.url.split("?")[1]||"")+"&",a=new RegExp("&"+e+"=(.*?)&","i");return t.match(a)?t.match(a)[1]:void 0},Ajax.prototype.on=function(e,t){return e=e.toLowerCase(),["get","error"].indexOf(e)>-1&&(this._events[e]=t),this},Ajax.prototype.update=function(e){var t=new XMLHttpRequest;return this.url=e,this.qs("q")?(t.open("GET",e||this.url),t.send(),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){for(var e=document.body.getElementsByTagName("script"),a=0;a<e.length;a++)e[a].classList.contains("search_result")&&e[a].parentElement.removeChild(e[a]);var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.classList.add("search_result"),n.innerHTML=t.responseText,document.body.appendChild(n)}},t):void 0},Ajax.prototype.callback=function(e){this._events.get(e)};var Pagination=function(){this.pages=0,this.currentPage=0};Pagination.prototype.setPage=function(e){this.currentPage=e},Pagination.prototype.setTotal=function(e){this.pages=e},Pagination.prototype.prevHTML=function(){return $div("prevPage","←")},Pagination.prototype.nextHTML=function(){return $div("nextPage","→")},Pagination.prototype.html=function(e,t){return pagination.prevHTML().html()+" "+this.currentPage+"/"+this.pages+" "+pagination.nextHTML().html()},Pagination.prototype.hasPrev=function(){return this.currentPage>1},Pagination.prototype.hasNext=function(){return this.currentPage<this.pages};var search=new URL,ajax=new Ajax(search.url()),pagination=new Pagination;search.on("update",function(){ajax.update(search.url()),sessionStorage.setItem("searchTerm",search.qs.q)}),ajax.on("get",function(e){if(e){var t=e.streams,a=e._total,n=0===a?0:Math.floor(ajax.qs("offset")/10)+1,i=0===a?0:Math.ceil(a/10);pagination.setPage(n),pagination.setTotal(i),$id("count").innerText="Total Results: "+a,$id("pagination").innerHTML=pagination.html(),$id("bottom_pagination").innerHTML=pagination.html();for(var s=$id("video_results");s.lastChild;)s.lastChild.className=s.lastChild.className+" removing",s.removeChild(s.lastChild);if(0===a){$id("navigation_help").classList.remove("show");var r=$div("no_results","Sorry, no results for: <strong>"+search.qs.q+"</strong>");s.appendChild(r)}else $id("navigation_help").classList.add("show"),t.forEach(function(e){var t=$ele("img");t.src=e.preview.medium,t.width=192,t.height=108,t.align="left";var a=$div("display_name",e.channel.display_name),n=$div("desc",e.channel.status),i=$div("game_name","Playing "+e.game),r=$div("viewers",e.channel.views+" viewers"),o=$div("videos");o.appendChild(t),o.appendChild(a),o.appendChild(i),o.appendChild(r),o.appendChild(n),s.appendChild(o)})}}),document.addEventListener("DOMContentLoaded",function(){sessionStorage.getItem("searchTerm")&&($id("q").value=sessionStorage.getItem("searchTerm"),search.update($id("q").value)),$id("search").addEventListener("click",function(e){search.update($id("q").value)}),document.body.addEventListener("click",function(e){if(["nextPage","prevPage"].indexOf(e.target.className)>-1){var t=search.qs.limit;"prevPage"===e.target.className&&pagination.hasPrev()&&search.addOffset(-t),"nextPage"===e.target.className&&pagination.hasNext()&&search.addOffset(t),e.preventDefault()}})}),document.addEventListener("keydown",function(e){e.shiftKey||e.ctrlKey||e.altKey||(37===e.keyCode&&pagination.hasPrev()&&search.addOffset(-search.qs.limit),39===e.keyCode&&pagination.hasNext()&&search.addOffset(search.qs.limit))});